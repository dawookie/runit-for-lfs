====================================================================================

Installation of Runit

====================================================================================

This document will explain how exactly to install Runit plus the Runit bootscripts
from this package.

This hint is aimed at LFS distributions that do not have sysvinit-2.88dsf installed
as well as the LFS-bootscripts package, or have removed them from the system.

If you need help removing sysvinit-2.88dsf from the system, as well as the
LFS-bootscripts, this next section will explain how, otherwise you can skip to the
next topic.

To uninstall the LFS-bootscripts, unpack the lfs-bootscripts-<date>.tar.bz2
package normally and run:

  make uninstall
  
This will uninstall all of the sysvinit bootscripts, and remove any files unneeded
by the system.

Next we will uninstall sysvinit-2.88dsf. To uninstall you'll have to do work
manually as sysvinit's makefile does not provide an uninstall command.:

  pushd /usr/share/man/man8
  rm -rvf halt.8 init.8 killall5.8 poweroff.8 reboot.8 runlevel.8 shutdown.8 \
  telinit.8 fstab-decode.8 bootlogd.8
  popd
  pushd /sbin
  rm -rvf init halt shutdown runlevel killall5 fstab-decode bootlogd poweroff \
  telinit reboot
  popd
  
Now sysvinit-2.88dsf and all utilities it installed will be removed to allow
Runit-2.1.2 to install cleanly along with the other runit-for-lfs tools and
bootscripts. Now you have a clean system to install a new init into.

------------------------------------------------------------------------------------

First download a copy of Runit from the Runit homepage here:

  http://smarden.org/runit/runit-2.1.2.tar.gz

Or use git to checkout a copy:

  git clone http://smarden.org/git/runit.git
  
Unpack the sources as you would any other source package and the change directory to
the Runit directory in the package as such:

  cd admin/runit-2.1.2

Now we'll build the package using this command:

  package/compile
  
This will build all the relevant software and manpages. Now while in the runit-2.1.1
base directory, we'll install Runit into the system:

  cd command
  install -v runit runit-init /sbin
  install -v runsvdir runsv chpst svlogd sv /usr/bin
  install -v runsvchdir utmpset /usr/sbin
  cp -v ../man/* /usr/share/man/man8
  ln -svf /sbin/runit-init /sbin/init
  mkdir -pv /etc/sv
  mkdir -pv /etc/runit/runsvdir/single
  mkdir -pv /etc/runit/runsvdir/multi
  
This should install all files to the proper locations.

To install runit-for-lfs, simply run:

make && make install
  
Several binaries and scripts critical to the system controls will be installed:

  pause    - /usr/bin - A simple service state holding program.
  shutdown - /sbin    - A script that functions to shutdown the system.
  halt     - /sbin    - A program to mimic the functions of sysvinit's halt.
  reboot   - /sbin    - A symlink to halt that issues restart command.
  poweroff - /sbin    - A symlink to halt that powers down the system.
  suspend  - /sbin    - A small program to suspend the system state.

Along with these, several key components of the LFS networking scripts will be
installed as well.

Also, if you have any legacy sysvinit scripts, you may drop them into the
/etc/runit/rc.d folder and create an entry in /etc/rc.local for them to work
from.

Lastly, most LFS systems have a udev rule that runs the LFS setclock initscript at 
boot time. That rule needs to be disabled. Your new Runit init system will handle
the hardware and system clocks by another method. As root...

  sed -i '/setclock\ start/ s/^/#/' /etc/udev/rules.d/55-lfs.rules

================================================================================

Description of application files:

runit - It performs the system?s booting, running, and shutdown in three stages.

runit-init - The first process the kernel starts.

sv - Controls and manages services monitored by runsv.

runsvdir - Starts and monitors a collection of runsv processes.

runsvchdir - Changes services directory of runsvdir.

runsv - Starts and monitors a service and optionally an appendant log service.

svlogd - Runit's service logging daemon.

chpst - Runs a program with a changed process state.

utmpset - Logout a line from utmp and wtmp file.

================================================================================
  
